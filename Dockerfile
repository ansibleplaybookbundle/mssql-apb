FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBtc3NxbC1hcGIKZGVzY3JpcHRpb246IERlcGxveW1lbnQg\
b2YgTWljcm9zb2Z0IFNRTCBTZXJ2ZXIgb24gTGludXgKYmluZGFibGU6IHRydWUKYXN5bmM6IG9w\
dGlvbmFsCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBNaWNyb3NvZnQgU1FMIFNlcnZlciBvbiBM\
aW51eAogIGltYWdlVXJsOgogICAgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2Fu\
c2libGVwbGF5Ym9va2J1bmRsZS9tc3NxbC1hcGIvbWFzdGVyL2RvY3MvaW1nL3NxbC1zZXJ2ZXIu\
cG5nCiAgZG9jdW1lbnRhdGlvblVybDoKICAgIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2Vu\
LXVzL3NxbC9saW51eC9zcWwtc2VydmVyLWxpbnV4LW92ZXJ2aWV3CiAgZGVwZW5kZW5jaWVzOiBb\
J3JlZ2lzdHJ5LmNlbnRvcy5vcmcvbWljcm9zb2Z0L21zc3FsLXNlcnZlci1saW51eCddCnRhZ3M6\
CiAgLSBkYXRhYmFzZQogIC0gbXNzcWwKcGxhbnM6CiAgLSBuYW1lOiBlcGhlbWVyYWwKICAgIGRl\
c2NyaXB0aW9uOiBUaGlzIHBsYW4gZGVwbG95cyBhbiBlcGhlbWVyYWwgTWljcm9zb2Z0IFNRTCBT\
ZXJ2ZXIgb24gTGludXgKICAgIGZyZWU6IHRydWUKICAgIGRlZmF1bHQ6IHRydWUKICAgIG1ldGFk\
YXRhOgogICAgICBkaXNwbGF5TmFtZTogRXBoZW1lcmFsIGluc3RhbGxhdGlvbgogICAgICBsb25n\
RGVzY3JpcHRpb246CiAgICAgICAgVGhpcyBwbGFuIHdpbGwgZGVwbG95IGEgc3RhbmRhbG9uZSBN\
aWNyb3NvZnQgU1FMIFNlcnZlciBvbiBMaW51eAogICAgICAgIHVzaW5nIGVwaGVtZXJhbCBzdG9y\
YWdlCiAgICBwYXJhbWV0ZXJzOgogICAgICAtIG5hbWU6IEFDQ0VQVF9FVUxBCiAgICAgICAgdGl0\
bGU6IEFjY2VwdCB0aGUgRW5kLVVzZXIgTGljZW5zaW5nIEFncmVlbWVudAogICAgICAgIHR5cGU6\
IGJvb2xlYW4KICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IGZhbHNlCiAg\
ICAgICAgZGVzY3JpcHRpb246IGh0dHA6Ly9nby5taWNyb3NvZnQuY29tL2Z3bGluay8/TGlua0lk\
PTc0NjM4OAogICAgICAgIGRpc3BsYXlfZ3JvdXA6IEVVTEEgUmVxdWlyZWQKICAgICAgLSBuYW1l\
OiBNU1NRTF9QQVNTV09SRAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDog\
IkhlbGxvMTIzISIKICAgICAgICBwYXR0ZXJuOiAiXig/Oig/OlthLXpdKy4qW0EtWl0rLiooXFxk\
fFxcVykrLiopXAogICAgICAgICAgfCg/OltBLVpdKy4qW2Etel0rLiooXFxkfFxcVykrLiopXAog\
ICAgICAgICAgfCg/OihcXGR8XFxXKSsuKlthLXpdLipbQS1aXS4qKXwoPzooXFxkfFxcVykrLipb\
QS1aXSsuKlthLXpdKy4qKVwKICAgICAgICAgIHwoPzpbQS1aXSsuKihcXGR8XFxXKSsuKlthLXpd\
Ky4qKXwoPzpbYS16XSsuKihcXGR8XFxXKSsuKltBLVpdKy4qKVwKICAgICAgICAgIHwoPzpcXGQr\
LipcXFcrLiooW0EtWl18W2Etel0pKy4qKXwoPzpcXFcrLipcXGQrLiooW0EtWl18W2Etel0pKy4q\
KVwKICAgICAgICAgIHwoPzooW0EtWl18W2Etel0pKy4qXFxkKy4qXFxXKy4qKXwoPzooW0EtWl18\
W2Etel0pKy4qXFxXKy4qXFxkKy4qKVwKICAgICAgICAgIHwoPzpcXFcrLiooW0EtWl18W2Etel0p\
Ky4qXFxkKy4qKXwoPzpcXGQrLiooW0EtWl18W2Etel0pKy4qXFxXKy4qKSkkIgogICAgICAgIHR5\
cGU6IHN0cmluZwogICAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgICB0aXRsZTog\
IkRhdGFiYXNlIEFkbWluIChTQSkgUGFzc3dvcmQiCiAgICAgICAgZGVzY3JpcHRpb246CiAgICAg\
ICAgICAiVGhlIHBhc3N3b3JkIG11c3QgYmUgYXQgbGVhc3QgOCBjaGFyYWN0ZXJzIGxvbmcgYW5k\
IGNvbnRhaW4KICAgICAgICAgIGNoYXJhY3RlcnMgZnJvbSB0aHJlZSBvZiB0aGUgZm9sbG93aW5n\
IGZvdXIgc2V0czogVXBwZXJjYXNlCiAgICAgICAgICBsZXR0ZXJzLCBMb3dlcmNhc2UgbGV0dGVy\
cywgQmFzZSAxMCBkaWdpdHMsIGFuZCBTeW1ib2xzIgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IE1p\
Y3Jvc29mdCBTUUwgQ29uZmlnCiAgICAgICAgbWluX2xlbmd0aDogOAogICAgICAgIG1heF9sZW5n\
dGg6IDEyOAogICAgICAtIG5hbWU6IE1TU1FMX0RBVEFCQVNFCiAgICAgICAgcmVxdWlyZWQ6IHRy\
dWUKICAgICAgICBkZWZhdWx0OiBUZXN0REIKICAgICAgICBwYXR0ZXJuOiAiXlthLXpBLVowLTlf\
LV0qJCIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogTWljcm9zb2Z0IFNRTCBE\
YXRhYmFzZSBOYW1lCiAgICAgICAgZGlzcGxheV9ncm91cDogTWljcm9zb2Z0IFNRTCBDb25maWcK\
ICAgICAgLSBuYW1lOiBNU1NRTF9BR0VOVF9FTkFCTEVECiAgICAgICAgdGl0bGU6IEVuYWJsZSBT\
UUwgU2VydmVyIEFnZW50CiAgICAgICAgdHlwZTogYm9vbGVhbgogICAgICAgIHJlcXVpcmVkOiB0\
cnVlCiAgICAgICAgZGVmYXVsdDogZmFsc2UKICAgICAgICBkaXNwbGF5X2dyb3VwOiBNaWNyb3Nv\
ZnQgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FMX1BJRAogICAgICAgIHJlcXVpcmVkOiB0\
cnVlCiAgICAgICAgdHlwZTogZW51bQogICAgICAgIGVudW06IFsnRGV2ZWxvcGVyJywgJ0V2YWx1\
YXRpb24nXQogICAgICAgIGRlZmF1bHQ6IERldmVsb3BlcgogICAgICAgIHRpdGxlOiBTUUwgU2Vy\
dmVyIEVkaXRpb24KICAgICAgICBkaXNwbGF5X2dyb3VwOiBNaWNyb3NvZnQgU1FMIENvbmZpZwog\
ICAgICAtIG5hbWU6IE1TU1FMX0xPQ0FMX0lTCiAgICAgICAgdGl0bGU6IFVzZSBleGlzdGluZyBt\
c3NxbC1zZXJ2ZXItbGludXggaW1hZ2VzdHJlYW0gaW4gcHJvamVjdAogICAgICAgIHR5cGU6IGJv\
b2xlYW4KICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICAg\
ICAgZGlzcGxheV9ncm91cDogTWljcm9zb2Z0IFNRTCBDb25maWcKICAgICAgLSBuYW1lOiBNU1NR\
TF9MQ0lECiAgICAgICAgdGl0bGU6IExhbmd1YWdlIElECiAgICAgICAgdHlwZTogaW50ZWdlcgog\
ICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogMTAzMwogICAgICAgIGRlc2Ny\
aXB0aW9uOiBlLmcuLCAxMDMzIGlzIEVuZ2xpc2ggKFVTKSwgMTAzNiBpcyBGcmVuY2gKICAgICAg\
ICBtaW5fbGVuZ3RoOiA0CiAgICAgICAgbWF4X2xlbmd0aDogNAogICAgICAgIGRpc3BsYXlfZ3Jv\
dXA6IE1pY3Jvc29mdCBTUUwgQ29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfSU1BR0VfUFVMTAog\
ICAgICAgIHRpdGxlOiAiRGVwbG95bWVudENvbmZpZyBJbWFnZSBwdWxsIHBvbGljeSIKICAgICAg\
ICB0eXBlOiBlbnVtCiAgICAgICAgZW51bTogWydBbHdheXMnLCAnSWZOb3RQcmVzZW50JywgJ05l\
dmVyJ10KICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IElmTm90UHJlc2Vu\
dAogICAgICAgIGRpc3BsYXlfZ3JvdXA6IE1pY3Jvc29mdCBTUUwgQ29uZmlnCiAgICAgIC0gbmFt\
ZTogTVNTUUxfTUVNT1JZX0xJTUlUCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZh\
dWx0OiAzCiAgICAgICAgdHlwZTogaW50ZWdlcgogICAgICAgIHRpdGxlOgogICAgICAgICAgTWF4\
aW11bSBhbW91bnQgb2YgbWVtb3J5IHRoZSBjb250YWluZXIgY2FuIHVzZSAoaW4gR0IpIGVnIDFH\
QiAyR0IKICAgICAgICBkaXNwbGF5X2dyb3VwOiBFbnZpcm9ubWVudCBTaXppbmcKICAgICAgLSBu\
YW1lOiBNU1NRTF9NRU1PUllfUkVRVUVTVAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAg\
ZGVmYXVsdDogMgogICAgICAgIHR5cGU6IGludGVnZXIKICAgICAgICB0aXRsZToKICAgICAgICAg\
IFJlcXVlc3RlZCBhbW91bnQgb2YgbWVtb3J5IGZvciB0aGUgY29udGFpbmVyIHRvIHN0YXJ0IChp\
biBHQikKICAgICAgICAgIGVnIDFHQiAyR0IKICAgICAgICBkaXNwbGF5X2dyb3VwOiBFbnZpcm9u\
bWVudCBTaXppbmcKCiAgLSBuYW1lOiBwZXJzaXN0ZW50CiAgICBkZXNjcmlwdGlvbjogVGhpcyBw\
bGFuIGRlcGxveXMgYSBwZXJzaXN0ZW50IE1pY3Jvc29mdCBTUUwgU2VydmVyIG9uIExpbnV4CiAg\
ICBmcmVlOiB0cnVlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IFBlcnNpc3RlbnQg\
aW5zdGFsbGF0aW9uCiAgICAgIGxvbmdEZXNjcmlwdGlvbjoKICAgICAgICBUaGlzIHBsYW4gd2ls\
bCBkZXBsb3kgYSBzdGFuZGFsb25lIE1pY3Jvc29mdCBTUUwgU2VydmVyIG9uIExpbnV4CiAgICAg\
ICAgdXNpbmcgcGVyc2lzdGVudCBzdG9yYWdlCiAgICBwYXJhbWV0ZXJzOgogICAgICAtIG5hbWU6\
IEFDQ0VQVF9FVUxBCiAgICAgICAgdGl0bGU6IEFjY2VwdCB0aGUgRW5kLVVzZXIgTGljZW5zaW5n\
IEFncmVlbWVudAogICAgICAgIHR5cGU6IGJvb2xlYW4KICAgICAgICByZXF1aXJlZDogdHJ1ZQog\
ICAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICAgICAgZGVzY3JpcHRpb246IGh0dHA6Ly9nby5taWNy\
b3NvZnQuY29tL2Z3bGluay8/TGlua0lkPTc0NjM4OAogICAgICAgIGRpc3BsYXlfZ3JvdXA6IEVV\
TEEgUmVxdWlyZWQKICAgICAgLSBuYW1lOiBNU1NRTF9QQVNTV09SRAogICAgICAgIHJlcXVpcmVk\
OiB0cnVlCiAgICAgICAgZGVmYXVsdDogIkhlbGxvMTIzISIKICAgICAgICBwYXR0ZXJuOiAiXig/\
Oig/OlthLXpdKy4qW0EtWl0rLiooXFxkfFxcVykrLiopXAogICAgICAgICAgfCg/OltBLVpdKy4q\
W2Etel0rLiooXFxkfFxcVykrLiopXAogICAgICAgICAgfCg/OihcXGR8XFxXKSsuKlthLXpdLipb\
QS1aXS4qKXwoPzooXFxkfFxcVykrLipbQS1aXSsuKlthLXpdKy4qKVwKICAgICAgICAgIHwoPzpb\
QS1aXSsuKihcXGR8XFxXKSsuKlthLXpdKy4qKXwoPzpbYS16XSsuKihcXGR8XFxXKSsuKltBLVpd\
Ky4qKVwKICAgICAgICAgIHwoPzpcXGQrLipcXFcrLiooW0EtWl18W2Etel0pKy4qKXwoPzpcXFcr\
LipcXGQrLiooW0EtWl18W2Etel0pKy4qKVwKICAgICAgICAgIHwoPzooW0EtWl18W2Etel0pKy4q\
XFxkKy4qXFxXKy4qKXwoPzooW0EtWl18W2Etel0pKy4qXFxXKy4qXFxkKy4qKVwKICAgICAgICAg\
IHwoPzpcXFcrLiooW0EtWl18W2Etel0pKy4qXFxkKy4qKXwoPzpcXGQrLiooW0EtWl18W2Etel0p\
Ky4qXFxXKy4qKSkkIgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIGRpc3BsYXlfdHlwZTog\
cGFzc3dvcmQKICAgICAgICB0aXRsZTogIkRhdGFiYXNlIEFkbWluIChTQSkgUGFzc3dvcmQiCiAg\
ICAgICAgZGVzY3JpcHRpb246CiAgICAgICAgICAiVGhlIHBhc3N3b3JkIG11c3QgYmUgYXQgbGVh\
c3QgOCBjaGFyYWN0ZXJzIGxvbmcgYW5kIGNvbnRhaW4KICAgICAgICAgIGNoYXJhY3RlcnMgZnJv\
bSB0aHJlZSBvZiB0aGUgZm9sbG93aW5nIGZvdXIgc2V0czogVXBwZXJjYXNlCiAgICAgICAgICBs\
ZXR0ZXJzLCBMb3dlcmNhc2UgbGV0dGVycywgQmFzZSAxMCBkaWdpdHMsIGFuZCBTeW1ib2xzIgog\
ICAgICAgIGRpc3BsYXlfZ3JvdXA6IE1pY3Jvc29mdCBTUUwgQ29uZmlnCiAgICAgICAgbWluX2xl\
bmd0aDogOAogICAgICAgIG1heF9sZW5ndGg6IDEyOAogICAgICAtIG5hbWU6IE1TU1FMX0RBVEFC\
QVNFCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiBUZXN0REIKICAgICAg\
ICBwYXR0ZXJuOiAiXlthLXpBLVowLTlfLV0qJCIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
ICB0aXRsZTogTWljcm9zb2Z0IFNRTCBEYXRhYmFzZSBOYW1lCiAgICAgICAgZGlzcGxheV9ncm91\
cDogTWljcm9zb2Z0IFNRTCBDb25maWcKICAgICAgLSBuYW1lOiBNU1NRTF9BR0VOVF9FTkFCTEVE\
CiAgICAgICAgdGl0bGU6IEVuYWJsZSBTUUwgU2VydmVyIEFnZW50CiAgICAgICAgdHlwZTogYm9v\
bGVhbgogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogZmFsc2UKICAgICAg\
ICBkaXNwbGF5X2dyb3VwOiBNaWNyb3NvZnQgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FM\
X1BJRAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgdHlwZTogZW51bQogICAgICAgIGVu\
dW06IFsnRGV2ZWxvcGVyJywgJ0V2YWx1YXRpb24nXQogICAgICAgIGRlZmF1bHQ6IERldmVsb3Bl\
cgogICAgICAgIHRpdGxlOiBTUUwgU2VydmVyIEVkaXRpb24KICAgICAgICBkaXNwbGF5X2dyb3Vw\
OiBNaWNyb3NvZnQgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FMX0xPQ0FMX0lTCiAgICAg\
ICAgdGl0bGU6IFVzZSBleGlzdGluZyBtc3NxbC1zZXJ2ZXItbGludXggaW1hZ2VzdHJlYW0gaW4g\
cHJvamVjdAogICAgICAgIHR5cGU6IGJvb2xlYW4KICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAg\
ICAgIGRlZmF1bHQ6IGZhbHNlCiAgICAgICAgZGlzcGxheV9ncm91cDogTWljcm9zb2Z0IFNRTCBD\
b25maWcKICAgICAgLSBuYW1lOiBNU1NRTF9MQ0lECiAgICAgICAgdGl0bGU6IExhbmd1YWdlIElE\
CiAgICAgICAgdHlwZTogaW50ZWdlcgogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVm\
YXVsdDogMTAzMwogICAgICAgIGRlc2NyaXB0aW9uOiBlLmcuLCAxMDMzIGlzIEVuZ2xpc2ggKFVT\
KSwgMTAzNiBpcyBGcmVuY2gKICAgICAgICBtaW5fbGVuZ3RoOiA0CiAgICAgICAgbWF4X2xlbmd0\
aDogNAogICAgICAgIGRpc3BsYXlfZ3JvdXA6IE1pY3Jvc29mdCBTUUwgQ29uZmlnCiAgICAgIC0g\
bmFtZTogTVNTUUxfSU1BR0VfUFVMTAogICAgICAgIHRpdGxlOiAiRGVwbG95bWVudENvbmZpZyBJ\
bWFnZSBwdWxsIHBvbGljeSIKICAgICAgICB0eXBlOiBlbnVtCiAgICAgICAgZW51bTogWydBbHdh\
eXMnLCAnSWZOb3RQcmVzZW50JywgJ05ldmVyJ10KICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAg\
ICAgIGRlZmF1bHQ6IElmTm90UHJlc2VudAogICAgICAgIGRpc3BsYXlfZ3JvdXA6IE1pY3Jvc29m\
dCBTUUwgQ29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfREFUQV9TVE9SQUdFX1NJWkUKICAgICAg\
ICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IDEKICAgICAgICB0eXBlOiBpbnRlZ2Vy\
CiAgICAgICAgdGl0bGU6IFBlcnNpc3RlbnQgdm9sdW1lIHNpemUgZm9yIGRiIGRhdGEgKGluIEdC\
KSBlZyAxR0IgMkdCCiAgICAgICAgZGlzcGxheV9ncm91cDogRW52aXJvbm1lbnQgU2l6aW5nCiAg\
ICAgIC0gbmFtZTogTVNTUUxfTUVNT1JZX0xJTUlUCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAg\
ICAgICBkZWZhdWx0OiAzCiAgICAgICAgdHlwZTogaW50ZWdlcgogICAgICAgIHRpdGxlOgogICAg\
ICAgICAgTWF4aW11bSBhbW91bnQgb2YgbWVtb3J5IHRoZSBjb250YWluZXIgY2FuIHVzZSAoaW4g\
R0IpIGVnIDFHQiAyR0IKICAgICAgICBkaXNwbGF5X2dyb3VwOiBFbnZpcm9ubWVudCBTaXppbmcK\
ICAgICAgLSBuYW1lOiBNU1NRTF9NRU1PUllfUkVRVUVTVAogICAgICAgIHJlcXVpcmVkOiB0cnVl\
CiAgICAgICAgZGVmYXVsdDogMgogICAgICAgIHR5cGU6IGludGVnZXIKICAgICAgICB0aXRsZToK\
ICAgICAgICAgIFJlcXVlc3RlZCBhbW91bnQgb2YgbWVtb3J5IGZvciB0aGUgY29udGFpbmVyIHRv\
IHN0YXJ0IChpbiBHQikKICAgICAgICAgIGVnIDFHQiAyR0IKICAgICAgICBkaXNwbGF5X2dyb3Vw\
OiBFbnZpcm9ubWVudCBTaXppbmcK"

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN chown -R apb:0 /opt/{ansible,apb} && \
    chmod -R g=u /opt/{ansible,apb}
USER apb
ENV ANSIBLE_PIPELINING=True \
    ANSIBLE_CALLBACK_WHITELIST=profile_tasks
